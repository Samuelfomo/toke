# ü§ñ Automation Integration Guide

> **Invitation Tok√©**  
> Generated by WAP Platform on 2025-11-17 15:47:05 UTC

---

## üìã Overview

| Property | Value |
|----------|-------|
| **Automation Name** | Invitation Tok√© |
| **Description** | Invitation √† t√©l√©charger Tok√© manager |
| **Template** | toke_app_guest (Marketing) |
| **Language** | fr |
| **Webhook URL** | `https://p.wap.cm/automation/` |
| **Status** | validated |
| **Created** | 2025-11-15T17:43:09+00:00 |

---

## üîê Authentication

All requests must include **HMAC-SHA256 signature** in headers:

```
X-Api-Key: YOUR-API-KEY
X-Api-Timestamp: {unix_timestamp}
X-Api-Signature: {hmac_sha256_signature}
```

### Signature Generation

1. **Message to sign**: `apiKey + timestamp`
2. **Secret**: Base64-decode your API Secret
3. **Algorithm**: HMAC-SHA256
4. **Encode**: Base64-encode the result

**Your API Credentials:**

```
API Key:    YOUR-API-KEY
API Secret: YOUR-API-SECRET
```

> ‚ö†Ô∏è **Security Note**: Never commit your API credentials to version control. Store them securely in environment variables.

---

## üìù Variables

### Body Variables

| Position | Name | Example |
|----------|------|----------|
| `{{1}}` | `user_code` | `123456` |

### Button Variables (Dynamic URLs)

| Button | Variable Name | Example |
|--------|---------------|----------|
| **Version Andro√Ød** | `android_link` | `#` |
| **Version iPhone** | `ios_link` | `#` |

---

## üì¶ Request Payload

### Required Fields

```json
{
  "reference": "2716055718",
  "country": "CM",
  "recipient": "237690000000",
  "scheduled": "2025-11-17T10:00:00.000Z",
  "variables": {
    "user_code": "123456",
  },
  "buttons": {
    "android_link": "#",
    "ios_link": "#"
  }
}
```

---

## üß™ Quick Test (Bash Script)

Copy and save this script as `test-automation.sh`, then run:

```bash
chmod +x test-automation.sh
./test-automation.sh
```

```bash
curl -X POST 'https://p.wap.cm/automation/' \
  -H 'Content-Type: application/json' \
  -H 'X-Api-Key: {{votre_api_key}}' \
  -H 'X-Api-Timestamp: {{timestamp_unix}}' \
  -H 'X-Api-Signature: {{hmac_sha256_signature}}' \
  -d '{"reference":2716055718,"country":"CM","recipient":"690000000","scheduled":"2025-11-17T15:47:05.101Z","variables":{"user_code":"123456"},"buttons":{"android_link":"#","ios_link":"#"}}'

# NOTE: G√©n√©rez la signature HMAC-SHA256 sur: api_key + timestamp
# en utilisant votre API Secret (base64 d√©cod√©).
```

---

## üíª Integration Examples

### cURL

```bash
curl -X POST 'https://p.wap.cm/automation/' \
  -H 'Content-Type: application/json' \
  -H 'X-Api-Key: {{votre_api_key}}' \
  -H 'X-Api-Timestamp: {{timestamp_unix}}' \
  -H 'X-Api-Signature: {{hmac_sha256_signature}}' \
  -d '{"reference":2716055718,"country":"CM","recipient":"690000000","scheduled":"2025-11-17T15:47:05.101Z","variables":{"user_code":"123456"},"buttons":{"android_link":"#","ios_link":"#"}}'
```

### PHP

```php
<?php

// Configuration API WhatsApp Automation
$apiKey = '{{votre_api_key}}';
$apiSecret = '{{votre_api_secret_base64}}';
$endpoint = 'https://p.wap.cm/automation/';

// Donn√©es du message
$payload = array (
  'reference' => 2716055718,
  'country' => 'CM',
  'recipient' => '690000000',
  'scheduled' => '2025-11-17T15:47:05.101Z',
  'variables' => 
  array (
    'user_code' => '123456',
  ),
  'buttons' => 
  array (
    'android_link' => '#',
    'ios_link' => '#',
  ),
);

$jsonPayload = json_encode($payload);

// G√©n√©ration timestamp
$timestamp = time();

// Message √† signer (apiKey + timestamp)
$message = $apiKey . $timestamp;

// D√©codage du secret base64
$secretBytes = base64_decode($apiSecret);

// G√©n√©ration de la signature HMAC-SHA256
$signature = base64_encode(hash_hmac('sha256', $message, $secretBytes, true));

// En-t√™tes avec authentification
$headers = [
    'Content-Type: application/json',
    'X-Api-Key: ' . $apiKey,
    'X-Api-Timestamp: ' . $timestamp,
    'X-Api-Signature: ' . $signature
];

// Envoi de la requ√™te
$ch = curl_init($endpoint);
curl_setopt($ch, CURLOPT_POST, true);
curl_setopt($ch, CURLOPT_POSTFIELDS, $jsonPayload);
curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);

$response = curl_exec($ch);
$httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
curl_close($ch);

echo "HTTP $httpCode: " . $response;
```

### JavaScript (Node.js)

```javascript
// WhatsApp Automation Trigger
const webhookUrl = 'https://p.wap.cm/automation/';
const payload = {
    "reference": "auto_691b437918c11",
    "country": "CM",
    "recipient": "690000000",
    "scheduled": "2025-11-17T15:47:05.101Z",
    "variables": {
        "user_code": "123456"
    },
    "buttons": {
        "android_link": "#",
        "ios_link": "#"
    }
};

fetch(webhookUrl, {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify(payload)
})
.then(response => response.json())
.then(data => {
    if (data.success) {
        console.log('Message sent successfully:', data);
    } else {
        console.error('Error sending message:', data.message);
    }
})
.catch(error => {
    console.error('Network error:', error);
});
```

### Python

```python
import requests
import json

# WhatsApp Automation Trigger
webhook_url = 'https://p.wap.cm/automation/'
payload = {
    "reference": "auto_691b437918c17",
    "country": "CM",
    "recipient": "690000000",
    "scheduled": "2025-11-17T15:47:05.101Z",
    "variables": {
        "user_code": "123456"
    },
    "buttons": {
        "android_link": "#",
        "ios_link": "#"
    }
}

try:
    response = requests.post(
        webhook_url,
        headers={'Content-Type': 'application/json'},
        json=payload,
        timeout=30
    )
    response.raise_for_status()
    
    result = response.json()
    if result.get('success'):
        print('Message sent successfully:', result)
    else:
        print('Error sending message:', result.get('message'))
        
except requests.exceptions.RequestException as e:
    print(f'Network error: {e}')
except json.JSONDecodeError as e:
    print(f'JSON decode error: {e}')
```

---

## üìä Response Codes

| Code | Description |
|------|-------------|
| `200` | Success - Message queued for delivery |
| `400` | Bad Request - Invalid payload or missing required fields |
| `404` | Not Found - Automation not found or inactive |
| `429` | Too Many Requests - Rate limit exceeded |
| `500` | Internal Server Error - System error occurred |

---

## ‚úÖ Testing Checklist

- [ ] Verify webhook URL is accessible
- [ ] Test with minimal payload
- [ ] Test with all variables
- [ ] Verify response handling
- [ ] Test error scenarios

---

## üìû Support

- **Rate Limit**: 100 requests per minute
- **Timeout**: 30 seconds
- **Retry Policy**: Exponential backoff, max 3 retries

For issues or questions, contact your WAP Platform administrator.

---

*Generated by WAP Platform - WhatsApp Business API Management*
